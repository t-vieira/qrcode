# Apache Virtual Host Configuration for QR Code SaaS Platform
# Para servidor compartilhado - qr.fluxti.com.br

<VirtualHost *:80>
    ServerName qr.fluxti.com.br
    ServerAlias www.qr.fluxti.com.br
    DocumentRoot /path/to/qrcodesaas/public
    
    # Redirecionar HTTP para HTTPS
    RewriteEngine On
    RewriteCond %{HTTPS} off
    RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
    
    # Logs
    ErrorLog /path/to/logs/qr.fluxti.com.br_error.log
    CustomLog /path/to/logs/qr.fluxti.com.br_access.log combined
    
    # Configurações de segurança
    <Directory "/path/to/qrcodesaas/public">
        AllowOverride All
        Require all granted
        
        # Bloquear acesso a arquivos sensíveis
        <FilesMatch "\.(env|log|sql|bak|backup|old|tmp)$">
            Require all denied
        </FilesMatch>
        
        # Bloquear acesso a diretórios sensíveis
        <DirectoryMatch "(vendor|storage/logs|bootstrap/cache|config|database|resources|tests)">
            Require all denied
        </DirectoryMatch>
    </Directory>
    
    # Configurações específicas para storage
    <Directory "/path/to/qrcodesaas/storage">
        Require all denied
    </Directory>
    
    # Permitir acesso apenas ao storage/app/public
    <Directory "/path/to/qrcodesaas/storage/app/public">
        Require all granted
        
        # Bloquear execução de PHP
        <FilesMatch "\.php$">
            Require all denied
        </FilesMatch>
    </Directory>
</VirtualHost>

<VirtualHost *:443>
    ServerName qr.fluxti.com.br
    ServerAlias www.qr.fluxti.com.br
    DocumentRoot /path/to/qrcodesaas/public
    
    # SSL Configuration
    SSLEngine on
    SSLCertificateFile /path/to/ssl/qr.fluxti.com.br.crt
    SSLCertificateKeyFile /path/to/ssl/qr.fluxti.com.br.key
    SSLCertificateChainFile /path/to/ssl/qr.fluxti.com.br.chain.crt
    
    # SSL Security Settings
    SSLProtocol all -SSLv3 -TLSv1 -TLSv1.1
    SSLCipherSuite ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256
    SSLHonorCipherOrder off
    SSLSessionTickets off
    
    # HSTS
    Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
    
    # Logs
    ErrorLog /path/to/logs/qr.fluxti.com.br_ssl_error.log
    CustomLog /path/to/logs/qr.fluxti.com.br_ssl_access.log combined
    
    # Configurações de segurança
    <Directory "/path/to/qrcodesaas/public">
        AllowOverride All
        Require all granted
        
        # Bloquear acesso a arquivos sensíveis
        <FilesMatch "\.(env|log|sql|bak|backup|old|tmp)$">
            Require all denied
        </FilesMatch>
        
        # Bloquear acesso a diretórios sensíveis
        <DirectoryMatch "(vendor|storage/logs|bootstrap/cache|config|database|resources|tests)">
            Require all denied
        </DirectoryMatch>
    </Directory>
    
    # Configurações específicas para storage
    <Directory "/path/to/qrcodesaas/storage">
        Require all denied
    </Directory>
    
    # Permitir acesso apenas ao storage/app/public
    <Directory "/path/to/qrcodesaas/storage/app/public">
        Require all granted
        
        # Bloquear execução de PHP
        <FilesMatch "\.php$">
            Require all denied
        </FilesMatch>
        
        # Cache para QR Codes
        <IfModule mod_expires.c>
            ExpiresActive On
            ExpiresByType image/png "access plus 1 year"
            ExpiresByType image/jpg "access plus 1 year"
            ExpiresByType image/jpeg "access plus 1 year"
            ExpiresByType image/svg+xml "access plus 1 year"
        </IfModule>
        
        <IfModule mod_headers.c>
            Header set Cache-Control "public, max-age=31536000"
        </IfModule>
    </Directory>
    
    # Configurações PHP
    <IfModule mod_php8.c>
        php_value upload_max_filesize 10M
        php_value post_max_size 10M
        php_value max_execution_time 300
        php_value memory_limit 256M
        php_value session.cookie_secure 1
        php_value session.cookie_httponly 1
        php_value session.cookie_samesite Strict
        php_value date.timezone "America/Sao_Paulo"
        php_flag display_errors Off
        php_flag log_errors On
        php_value expose_php Off
    </IfModule>
</VirtualHost>

# Wildcard Virtual Host para domínios customizados
<VirtualHost *:443>
    ServerName *.qr.fluxti.com.br
    DocumentRoot /path/to/qrcodesaas/public
    
    # SSL Configuration (wildcard certificate)
    SSLEngine on
    SSLCertificateFile /path/to/ssl/wildcard.qr.fluxti.com.br.crt
    SSLCertificateKeyFile /path/to/ssl/wildcard.qr.fluxti.com.br.key
    SSLCertificateChainFile /path/to/ssl/wildcard.qr.fluxti.com.br.chain.crt
    
    # SSL Security Settings (same as main)
    SSLProtocol all -SSLv3 -TLSv1 -TLSv1.1
    SSLCipherSuite ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256
    SSLHonorCipherOrder off
    SSLSessionTickets off
    
    # HSTS
    Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
    
    # Logs
    ErrorLog /path/to/logs/wildcard.qr.fluxti.com.br_ssl_error.log
    CustomLog /path/to/logs/wildcard.qr.fluxti.com.br_ssl_access.log combined
    
    # Configurações de segurança (same as main)
    <Directory "/path/to/qrcodesaas/public">
        AllowOverride All
        Require all granted
        
        # Bloquear acesso a arquivos sensíveis
        <FilesMatch "\.(env|log|sql|bak|backup|old|tmp)$">
            Require all denied
        </FilesMatch>
        
        # Bloquear acesso a diretórios sensíveis
        <DirectoryMatch "(vendor|storage/logs|bootstrap/cache|config|database|resources|tests)">
            Require all denied
        </DirectoryMatch>
    </Directory>
    
    # Configurações específicas para storage (same as main)
    <Directory "/path/to/qrcodesaas/storage">
        Require all denied
    </Directory>
    
    <Directory "/path/to/qrcodesaas/storage/app/public">
        Require all granted
        
        <FilesMatch "\.php$">
            Require all denied
        </FilesMatch>
        
        <IfModule mod_expires.c>
            ExpiresActive On
            ExpiresByType image/png "access plus 1 year"
            ExpiresByType image/jpg "access plus 1 year"
            ExpiresByType image/jpeg "access plus 1 year"
            ExpiresByType image/svg+xml "access plus 1 year"
        </IfModule>
        
        <IfModule mod_headers.c>
            Header set Cache-Control "public, max-age=31536000"
        </IfModule>
    </Directory>
    
    # Configurações PHP (same as main)
    <IfModule mod_php8.c>
        php_value upload_max_filesize 10M
        php_value post_max_size 10M
        php_value max_execution_time 300
        php_value memory_limit 256M
        php_value session.cookie_secure 1
        php_value session.cookie_httponly 1
        php_value session.cookie_samesite Strict
        php_value date.timezone "America/Sao_Paulo"
        php_flag display_errors Off
        php_flag log_errors On
        php_value expose_php Off
    </IfModule>
</VirtualHost>
